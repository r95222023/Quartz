<div ng-hide="vm.preview" ng-if="!destroyDragula" ng-init="initDragula()" class="editor-full-height"
     layout="column">
    <md-toolbar class="md-menu-toolbar editor-toolbar" style="height:84px">
        <div layout="row">
            <md-toolbar-filler layout layout-align="center center" ui-sref="quartz.admin-default.pageManager">
                <md-icon md-font-icon="zmdi zmdi-view-web"></md-icon>
            </md-toolbar-filler>
            <div>
                <input type="text" class="docs-title-input" ng-model="vm.pageName">

                <md-menu-bar>
                    <md-menu>
                        <button ng-click="$mdOpenMenu()">
                            {{'GENERAL.FILE'|translate}}
                        </button>
                        <md-menu-content width="3">
                            <md-menu-item>
                                <md-button ui-sref="quartz.admin-default-no-scroll.pageEditor({pageName:''})">{{'GENERAL.NEW'|translate}}</md-button>
                            </md-menu-item>
                            <md-menu-item>
                                <md-button ui-sref="quartz.admin-default.pageManager">{{'GENERAL.OPEN'|translate}}</md-button>
                            </md-menu-item>
                            <md-menu-item>
                                <md-button ngf-select="vm.import($files)">{{'GENERAL.IMPORT'|translate}}</md-button>
                            </md-menu-item>
                            <md-menu-item>
                                <md-button ng-click="vm.export()" translate>{{'GENERAL.EXPORT'|translate}}</md-button>
                            </md-menu-item>
                            <md-menu-item>
                                <md-button ng-click="vm.update()" translate>{{'GENERAL.SAVE'|translate}}</md-button>
                            </md-menu-item>
                        </md-menu-content>
                    </md-menu>
                    <md-menu>
                        <button ng-click="$mdOpenMenu()">{{'GENERAL.EDIT'|translate}}</button>
                        <md-menu-content width="3">
                            <md-menu-item class="md-indent">
                                <md-icon md-svg-icon="undo"></md-icon>
                                <md-button ng-click="vm.undo()">{{'GENERAL.UNDO'|translate}}</md-button>
                            </md-menu-item>
                            <md-menu-item class="md-indent">
                                <md-icon md-svg-icon="redo"></md-icon>
                                <md-button ng-click="vm.redo()">{{'GENERAL.REDO'|translate}}</md-button>
                            </md-menu-item>
                        </md-menu-content>
                    </md-menu>
                    <md-menu>
                        <button ng-click="$mdOpenMenu()">{{'GENERAL.VIEW'|translate}}</button>
                        <md-menu-content width="3">
                            <md-menu-item>
                                <md-menu>
                                    <md-button ng-click="$mdOpenMenu()">{{'GENERAL.RESPONSIVEMODE'|translate}}</md-button>
                                    <md-menu-content width="3">
                                        <!--<md-menu-item ng-repeat="bp in vm.layoutOptions.breakpoints" type="radio" ng-model="vm.layoutBreakpoint" value="{{bp}}">{{bp}}</md-menu-item>-->
                                    </md-menu-content>
                                </md-menu>
                            </md-menu-item>
                            <md-menu-item>
                                <md-menu>
                                    <md-button ng-click="$mdOpenMenu()">{{'GENERAL.MEDIAWIDTH'|translate}}</md-button>
                                    <md-menu-content width="3">
                                        <md-menu-item type="radio" ng-model="vm.media" value="'all'">{{'GENERAL.ALL'|translate}}</md-menu-item>
                                        <md-menu-item type="radio" ng-model="vm.media" value="'0~599'">0~599</md-menu-item>
                                        <md-menu-item type="radio" ng-model="vm.media" value="'600~959'">600~959</md-menu-item>
                                        <md-menu-item type="radio" ng-model="vm.media" value="'960~1279'">960~1279</md-menu-item>
                                        <md-menu-item type="radio" ng-model="vm.media" value="'1280~1919'">1280~1919</md-menu-item>
                                        <md-menu-item type="radio" ng-model="vm.media" value="'>1920'">>1920</md-menu-item>
                                        <!--<md-menu-item type="radio" ng-repeat="mq in vm.layoutOptions.mediaQueries"-->
                                                      <!--ng-model="vm.media" value="{{mq}}">{{mq}}-->
                                        <!--</md-menu-item>-->
                                    </md-menu-content>
                                </md-menu>
                            </md-menu-item>

                            <md-menu-divider></md-menu-divider>
                            <md-menu-item ng-if="!vm.preview">
                                <md-button ng-click="vm.compile();vm.preview=true">{{'GENERAL.PREVIEW'|translate}}</md-button>
                            </md-menu-item>
                        </md-menu-content>
                    </md-menu>
                    <md-menu>
                        <button ng-click="$mdOpenMenu()">{{'GENERAL.TOOLS'|translate}}</button>
                        <md-menu-content width="3">
                            <md-menu-item ng-if="!vm.showCss">
                                <md-button ng-click="vm.showCss=true">{{'GENERAL.SHOW'|translate}}{{'GENERAL.CSSEDITOR'|translate}}</md-button>
                            </md-menu-item>
                            <md-menu-item ng-if="vm.showCss">
                                <md-button ng-click="vm.showCss=false">{{'GENERAL.HIDE'|translate}}{{'GENERAL.CSSEDITOR'|translate}}</md-button>
                            </md-menu-item>
                        </md-menu-content>
                    </md-menu>
                </md-menu-bar>
            </div>
            <div flex></div>
            <user-menu></user-menu>

        </div>
    </md-toolbar>
    <div layout="row" ng-show="!vm.preview" flex="100">
        <md-content flex="10" style="min-width: 100px">
            <div layout="column" layout-xs="column"
                 layout-align="start center"
                 layout-margin style="overflow: auto">
                <div>
                    Container
                </div>
                <div dragula='"drag-container-root"'
                     dragula-model='containerSource'>
                    <div style="cursor: move; background-color:#B2DFDB;"
                         class="md-whiteframe-2dp root-handle rootContainerSource"
                         layout-padding
                         layout-margin
                         ng-repeat="container in containerSource track by container.cid">
                        {{container.type}}
                    </div>
                </div>
                <div>
                    Subcontainer
                </div>
                <div dragula='"drag-container-lv1"'
                     dragula-model='subContainerSource'>
                    <div style="cursor: move; background-color:#BBDEFB;"
                         class="md-whiteframe-2dp lv1-handle subContainerSource"
                         layout-padding
                         layout-margin
                         ng-repeat="subcontainer in subContainerSource track by subcontainer.cid">
                        {{subcontainer.type}}
                    </div>
                </div>
                <div>
                    Widgets
                </div>
                <div dragula='"drag-container-lv2"'
                     dragula-model='subSubContainerSource'>
                    <div style="cursor: move;background-color:#F0F4C3;"
                         class="lv2-handle md-whiteframe-2dp widgetSource"
                         layout-padding
                         layout-margin
                         ng-repeat="widget in subSubContainerSource track by widget.cid">
                        {{widget.name||widget.type}}
                    </div>
                </div>
            </div>
        </md-content>
        <md-content flex>
            <div layout="row" ng-if="vm.showCss" layout-align="center" layout-wrap>
                <div flex="100" layout="row">
                    <span flex></span>
                    <md-button class="md-icon-button" aria-label="more action"
                               ng-click="vm.showCss=false"
                               aria-label="close css editor">
                        <md-icon md-font-icon="fa fa-times"></md-icon>
                    </md-button>
                </div>
                <textarea flex="90" type="text"
                          rows="100" cols="30"
                          ng-model="vm.pageCss"
                          ng-model-options="{debounce: { 'default': 500, 'blur': 0 } }"></textarea>
            </div>
            <div ng-hide="vm.showCss" style="cursor: move; width:100%;margin:0;">
                <md-button class="md-icon-button" aria-label="more action"
                           ng-click="vm.action('edit','canvas')"
                           aria-label="edit">
                    <md-icon md-font-icon="fa fa-pencil-square-o"></md-icon>
                </md-button>
            </div>
            <div ng-hide="vm.showCss" layout="{{vm.canvas.layout[vm.layoutBreakpoint].layout||'row'}}"
                 dragula='"drag-container-root"'
                 dragula-model='containers.root'
                 class="layout-wrap"
                 style="min-width: 100px;min-height: 100px">
                <div style="background-color:#B2DFDB;min-width: 100px;min-height: 100px"
                     class="md-whiteframe-3dp"
                     ng-class="vm.getLayoutClass(container.layout).outer"
                     layout="column"
                     ng-repeat="(rootIndex, container) in containers.root track by container.cid">
                    <div class="root-handle" style="cursor: move; width:100%;margin:0;">
                        <span>{{container.type==='text'? 'text': '<'+(container.tag||'div')+'>'}}</span>
                        <span ng-show="container.id">#{{container.id}}</span>

                        <!--<div>-->
                            <!--<md-select ng-model="vm.widget['root'+rootIndex]" ng-change="vm.action('setWidget','root', rootIndex)" placeholder="Select a state">-->
                                <!--<md-option ng-value="widget" ng-repeat="widget in vm.customWidgets">{{ widget.name }}</md-option>-->
                            <!--</md-select>-->
                        <!--</div>-->
                        <md-menu>
                            <md-button class="md-icon-button" aria-label="more action"
                                       ng-click="$mdOpenMenu();$event.stopPropagation();"
                                       aria-label="more action">
                                <md-icon md-font-icon="zmdi zmdi-more-vert"></md-icon>
                            </md-button>
                            <md-menu-content width="3">
                                <md-menu-item ng-repeat="action in vm.actions">
                                    <md-button
                                        ng-click="vm.action(action[0],'root', rootIndex)"
                                        translate="{{action[1]}}"
                                        aria-label="{{action[1]}}"></md-button>
                                </md-menu-item>
                            </md-menu-content>
                        </md-menu>

                    </div>
                    <div style="width:100%;min-width: 100px;min-height: 100px; overflow: hidden;"
                         ng-class="vm.getLayoutClass(container.layout).inner"
                         dragula="'drag-container-lv1'"
                         dragula-scope="$parent"
                         dragula-model="containers[container.cid]">

                        <div style="background-color:#BBDEFB; min-width: 100px;min-height: 100px;"
                             ng-class="vm.getLayoutClass(subcontainer.layout).outer"
                             layout="column"
                             class="md-whiteframe-3dp"
                             ng-repeat="(subIndex,subcontainer) in containers[container.cid] track by subcontainer.cid">
                            <div class="lv1-handle" style="cursor: move; margin:0;">
                                <!--<span ng-show="subcontainer.type!=='text'"><{{subcontainer.tag||'div'}}></span>-->
                                <span>{{subcontainer.type==='text'? 'text': '<'+(subcontainer.tag||'div')+'>'}}</span>
                                <span ng-show="subcontainer.id">#{{subcontainer.id}}</span>

                                <md-menu>
                                    <md-button class="md-icon-button" aria-label="more action"
                                               ng-click="$mdOpenMenu();$event.stopPropagation();"
                                               aria-label="more action">
                                        <md-icon md-font-icon="zmdi zmdi-more-vert"></md-icon>
                                    </md-button>
                                    <md-menu-content width="3">
                                        <md-menu-item ng-repeat="action in vm.actions">
                                            <md-button
                                                ng-click="vm.action(action[0],container.cid, subIndex)"
                                                translate="{{action[1]}}"
                                                aria-label="{{action[1]}}"></md-button>
                                        </md-menu-item>
                                    </md-menu-content>
                                </md-menu>
                            </div>
                            <div style="width:100%; min-height: 100px;overflow: hidden;"
                                 ng-class="vm.getLayoutClass(subcontainer.layout).inner"
                                 dragula='"drag-container-lv2"'
                                 dragula-scope="$parent.$parent"
                                 dragula-model='containers[subcontainer.cid]'>

                                <div style="background-color:#F0F4C3; min-width: 100px; cursor: move"
                                     ng-class="vm.getLayoutClass(widget.layout).outer"
                                     class="md-whiteframe-3dp dragable-widget lv2-handle"
                                     layout="column"
                                     layout-padding
                                     ng-repeat="(widgetIndex,widget) in containers[subcontainer.cid] track by widget.cid">
                                    <div class="lv2-handle" style="cursor: move; margin:0;">
                                        <span>{{widget.type==='text'? 'text': '<'+(widget.tag||'div')+'>'}}</span>
                                        <span ng-show="widget.id">#{{widget.id}}</span>

                                        <md-menu>
                                            <md-button class="md-icon-button" aria-label="more action"
                                                       ng-click="$mdOpenMenu();$event.stopPropagation();"
                                                       aria-label="more action">
                                                <md-icon md-font-icon="zmdi zmdi-more-vert"></md-icon>
                                            </md-button>
                                            <md-menu-content width="3">
                                                <md-menu-item ng-repeat="action in vm.actions">
                                                    <md-button
                                                        ng-click="vm.action(action[0],subcontainer.cid, widgetIndex)"
                                                        translate="{{action[1]}}"
                                                        aria-label="{{action[1]}}"></md-button>
                                                </md-menu-item>
                                            </md-menu-content>
                                        </md-menu>
                                    </div>

                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </md-content>
    </div>


</div>
<md-button ng-if="vm.preview" class="md-fab" aria-label="back to edit" ng-click="vm.preview=false" style="position:fixed; bottom:20px;left:20px">
    <md-icon md-font-icon="fa fa-pencil"></md-icon>
</md-button>
<md-content layout="column" ng-if="vm.preview">
    <custom-item layout="row" layout-wrap content="vm.html" scope="vm.scope"></custom-item>
</md-content>
<md-sidenav class="md-sidenav-right md-whiteframe-z2" md-component-id="editCustomItem">
    <md-toolbar class="md-theme-light">
        <h1 class="md-toolbar-tools">{{vm.item.type}}</h1>
    </md-toolbar>
    <md-tabs md-selected="vm.selectedSideEditorTab" md-dynamic-height md-border-bottom>
        <md-tab label="Options" ng-disabled="vm.item.type==='customWidget'">
            <div class="padding-30 md-tabs-content">
                <form>
                    <md-input-container>
                        <label>Tag</label>
                        <input type="text" ng-model="vm.item.tag">
                    </md-input-container>
                    <md-input-container>
                        <label>Id</label>
                        <input type="text" ng-model="vm.item.id">
                    </md-input-container>
                    <md-input-container>
                        <label>Controller</label>
                        <md-select ng-model="vm.item.ctrl">
                            <md-option ng-value="ctrl[0]" ng-repeat="ctrl in vm.ctrls">{{ ctrl[0] }}</md-option>
                        </md-select>
                    </md-input-container>
                    <md-input-container ng-if="vm.item.ctrl">
                        <label>Controller as</label>
                        <input type="text" ng-model="vm.item.ctrlAs">
                    </md-input-container>
                    <br>
                    Class
                    <textarea ng-if="vm.item.type!=='custom'||vm.item.type!=='customWidget'" type="text"
                              rows="5" cols="30"
                              ng-model="vm.item.class"></textarea>
                    Style
                    <textarea ng-if="vm.item.type!=='custom'||vm.item.type!=='customWidget'" type="text"
                              rows="5" cols="30"
                              ng-model="vm.item.style"></textarea>
                    Attrs
                    <textarea ng-if="vm.item.type!=='custom'||vm.item.type!=='customWidget'" type="text"
                              rows="5" cols="30"
                              ng-model="vm.item.attrs"></textarea>
                </form>
            </div>
        </md-tab>

        <md-tab label="Layout" ng-disabled="vm.item.type==='customWidget'">
            <div class="padding-40 md-tabs-content">
                <form layout="column">
                    <md-input-container ng-init="vm.layoutBreakpoint='all'">
                        <label>Breakpoint</label>
                        <md-select ng-model="vm.layoutBreakpoint">
                            <md-option ng-value="bp" ng-repeat="bp in vm.layoutOptions.breakpoints">{{ bp }}</md-option>
                        </md-select>
                    </md-input-container>
                    <md-input-container>
                        <label>layout</label>
                        <md-select ng-model="vm.item.layout[vm.layoutBreakpoint].layout">
                            <md-option ng-value="size" ng-repeat="size in vm.layoutOptions.layout.layout">{{ size }}
                            </md-option>
                        </md-select>
                    </md-input-container>
                    <md-input-container>
                        <label>flex</label>
                        <md-select ng-model="vm.item.layout[vm.layoutBreakpoint].flex">
                            <md-option ng-value="size" ng-repeat="size in vm.layoutOptions.layout.flex">{{ size }}
                            </md-option>
                        </md-select>
                    </md-input-container>
                    <md-input-container>
                        <label>flex-offset</label>
                        <md-select ng-model="vm.item.layout[vm.layoutBreakpoint]['flex-offset']">
                            <md-option ng-value="size" ng-repeat="size in vm.layoutOptions.layout['flex-offset']">
                                {{size}}
                            </md-option>
                        </md-select>
                    </md-input-container>
                    <md-input-container>
                        <label>flex-order</label>
                        <input type="number" ng-model="vm.item.layout[vm.layoutBreakpoint]['flex-order']">
                    </md-input-container>
                    <md-input-container>
                        <label>layout-align-x</label>
                        <md-select ng-model="vm.item.layout[vm.layoutBreakpoint]['layout-align'].x">
                            <md-option ng-value="xAlign"
                                       ng-repeat="xAlign in vm.layoutOptions.layout['layout-align'].x">{{ xAlign }}
                            </md-option>
                        </md-select>
                    </md-input-container>
                    <md-input-container>
                        <label>layout-align-y</label>
                        <md-select ng-model="vm.item.layout[vm.layoutBreakpoint]['layout-align'].y">
                            <md-option ng-value="yAlign"
                                       ng-repeat="yAlign in vm.layoutOptions.layout['layout-align'].y">{{ yAlign }}
                            </md-option>
                        </md-select>
                    </md-input-container>
                    <md-checkbox ng-disabled="vm.layoutBreakpoint!=='all'"
                                 ng-model="vm.item.layout[vm.layoutBreakpoint]['layout-fill']" ng-false-value="null">
                        Fill
                    </md-checkbox>
                    <md-checkbox ng-disabled="vm.layoutBreakpoint!=='all'"
                                 ng-model="vm.item.layout[vm.layoutBreakpoint]['layout-wrap']" ng-false-value="null">
                        Wrap
                    </md-checkbox>
                    <md-checkbox ng-disabled="vm.layoutBreakpoint!=='all'"
                                 ng-model="vm.item.layout[vm.layoutBreakpoint]['layout-nowrap']" ng-false-value="null">
                        Nowrap
                    </md-checkbox>
                    <md-checkbox ng-disabled="vm.layoutBreakpoint!=='all'"
                                 ng-model="vm.item.layout[vm.layoutBreakpoint]['layout-margin']" ng-false-value="null">
                        Margin
                    </md-checkbox>
                    <md-checkbox ng-disabled="vm.layoutBreakpoint!=='all'"
                                 ng-model="vm.item.layout[vm.layoutBreakpoint]['layout-padding']" ng-false-value="null">
                        Padding
                    </md-checkbox>
                    <md-checkbox ng-model="vm.item.layout[vm.layoutBreakpoint]['show']" ng-false-value="null">
                        Show
                    </md-checkbox>
                    <md-checkbox ng-model="vm.item.layout[vm.layoutBreakpoint]['hide']" ng-false-value="null">
                        hide
                    </md-checkbox>
                </form>
            </div>
        </md-tab>

        <md-tab label="HTML" layout-align="center start">
            <div class="padding-10 md-tabs-content">
                <form ng-if="vm.item.type==='custom'&&vm.item.type!=='customWidget'">
                    <md-button ng-if="!vm.htmlEditor" ng-click="vm.htmlEditor=true">Edit</md-button>
                    <md-button ng-if="vm.htmlEditor===true" ng-click="vm.htmlEditor=false">Hide</md-button>

                <textarea ng-if="vm.htmlEditor" type="text" id="testInput" rows="35" cols="34"
                          ng-model="vm.item.content" md-autofocus></textarea>
                </form>
                <div ng-if="vm.selectedSideEditorTab===2">
                    <code>{{vm.getHtmlContent(vm.item)}}</code>
                </div>

            </div>
        </md-tab>
    </md-tabs>
    <md-button ng-click="vm.updateItem()">OK</md-button>
    <md-button ng-click="vm.toggleEditor()">Cancel</md-button>

</md-sidenav>







